<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1, width=device-width, maximum-scale=1, minimum-scale=1, user-scalable=no">
  <meta name="format-detection" content="telephone=no">
  <meta name="format-detection" content="address=no">
  <link rel="stylesheet" href="../css/base.css">
  <link rel="stylesheet" href="../css/component.css">
  <link rel="stylesheet" href="../css/font-icon.css">
  <title>发表钓记--填写内容</title>
  <style>
    .opacity-half{
      opacity: 0.5;
    }

    .opacity-null{
      opacity: 1;
    }

    .bottom-actions{
      position: fixed;
      bottom: 0;
      left: 0; right: 0;
    }

    .bottom-actions li{
      float: left;
      width: 50%;
      text-align: center;
      font-size: 15px;
      height: 44px;
      line-height: 44px;
      color: #fff;
    }

    .bottom-actions li:first-child{
      background-color: #09bb07;
    }
    .bottom-actions li:last-child{
      background-color: #10aeff;
    }

    .bottom-actions li .icon-m{
      vertical-align: text-top;
      margin-right: 5px;
    }


  </style>
</head>
<body>
<div class="wrap">

  <!-- 头部 -->
  <div id="header" class="top-bar gray-style">
    <div class="l" id="back">
      <div class="icon-text-h">
        <span>取消</span>
      </div>
    </div>
    <div id="mapIcon" class="icon-text-h r">
      <span id="sendBtn" class="opacity-half">发送</span>
    </div>
  </div>
  <!-- 头部 end-->
  <div class="bottom-actions">
      <ul>
        <li id="addPic"><i class="icon-m icon-img"></i>插入图片</li>
        <li id="addText"><i class="icon-m icon-font"></i>插入文字</li>
      </ul>
    </div>
</div>
</body>
<script src="../script/api.js"></script>
<script src="../script/zepto.min.js"></script>
<script src="../script/common.js"></script>
<script>
  apiready = function() {
    // 设置ios7的标题栏字体变亮，全局用一个就行了
    api.setStatusBarStyle({
      style: 'dark'
    });

    api.addEventListener({
      name:'viewappear'
    },function(ret,err){
      // 设置ios7的标题栏字体变亮，全局用一个就行了
      api.setStatusBarStyle({
        style: 'dark'
      });
    });

    $('#back').on('tap',  function() {
      api.closeWin({
        name: 'publish-diaoji',
        animation: {
          type: 'reveal',
          subType: 'from_top',
          duration: 200
        }
      });
    });


    var header = $api.byId('header');
    $api.fixIos7Bar(header);

    var addPic   = $api.byId('addPic');
    var addPicPos = $api.offset(addPic);
    var headerPos = $api.offset(header);

    function openFrame() {
      api.openFrame({
        name: 'publish-diaoji',
        url: './publish-diaoji_frame.html',
        opaque: true,
        allowEdit : true,
        vScrollBarEnabled: true,
        pageParam : {'pondId' : api.pageParam['pondId'], 'pondName' : api.pageParam['pondName'],'topic_id' : api.pageParam['topic_id'],'topicName' : api.pageParam['topicName']},
        rect: {
          x: 0,
          y: $('.top-bar').offset().height,
          w: 'auto',
          h: api.winHeight - addPicPos.h - headerPos.h
        }
      });
    }

    openFrame();

    window.changeSendStatus = function(flag) {
      if(flag) {
        $('#sendBtn').removeClass('opacity-half').addClass('opacity-null');
      }else{
        $('#sendBtn').removeClass('opacity-null').addClass('opacity-half');
      }
    }
    
    $('#sendBtn').on('click', function() {
      if($(this).hasClass('opacity-null')) {

        api.execScript({
          frameName: 'publish-diaoji',
          script: 'sendDiaoji();'
        });

      }
    });
    
    //添加图片
    $('#addPic').on('tap',  function() {
      api.execScript({
        frameName: 'publish-diaoji',
        script: 'addPicsFn();'
      });
    });

    //添加文字
    $('#addText').on('tap',  function() {
      api.execScript({
        frameName: 'publish-diaoji',
        script: 'addTextFn();'
      });
    });
    

  }

</script>
</html>